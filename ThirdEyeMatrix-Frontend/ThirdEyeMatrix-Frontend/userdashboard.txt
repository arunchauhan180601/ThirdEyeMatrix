"use client";
import { BanknoteArrowDown, IndianRupee, LayoutGrid } from "lucide-react";
import Image from "next/image";
import { useEffect, useState } from "react";
import woocommerceImage from "@/assets/images/WooCommerce.svg";
import shopifyImage from "@/assets/images/shopify.svg";
import magentoImage from "@/assets/images/magentoLogoImage.png";
import metaAdsImage from "@/assets/images/meta.png";
import CustomMatrix from "@/components/user-dashboard-sections/custom-metrix";
import KlaviyoSection from "@/components/user-dashboard-sections/klaviyo";
import WebAnalysisSection from "@/components/user-dashboard-sections/web-analysis";
import GoogleAdsSection from "@/components/user-dashboard-sections/google-ads";

// Helper function to get currency symbol
const getCurrencySymbol = (currencyCode: string | null | undefined): string => {
  if (!currencyCode) return "₹"; // Default to INR

  const currencyMap: { [key: string]: string } = {
    CHF: "CHF",
    USD: "$",
    EUR: "€",
    GBP: "£",
    INR: "₹",
    JPY: "¥",
    CNY: "¥",
    CAD: "C$",
    AUD: "A$",
    NZD: "NZ$",
    SGD: "S$",
    HKD: "HK$",
    KRW: "₩",
    MXN: "$",
    BRL: "R$",
    ZAR: "R",
    SEK: "kr",
    NOK: "kr",
    DKK: "kr",
    PLN: "zł",
    TRY: "₺",
    RUB: "₽",
    THB: "฿",
    MYR: "RM",
    IDR: "Rp",
    PHP: "₱",
    VND: "₫",
  };

  return currencyMap[currencyCode.toUpperCase()] || currencyCode;
};

// ---------- Shopify ----------
interface ShopifyProduct {
  id: string;
  title: string;
  variants: { price: string }[];
}
interface ShopifyCustomer {
  id: string;
  first_name: string;
  last_name: string;
  email: string;
}
interface ShopifyRefund {
  id: string;
  created_at: string;
  note?: string;
  restock?: boolean;

  // Array of refunded line items
  refund_line_items?: {
    id: string;
    quantity: number;
    line_item?: {
      id: string;
      title: string;
      price: string;
      quantity: number;
      sku?: string;
    };
  }[];
}

interface ShopifyOrder {
  id: string;
  name: string;
  total_price: string;
  total_discounts: string;
  total_tax: string;
  confirmed: boolean;
  status: string;
  financial_status: string;
  created_at: string;
  refunds?: ShopifyRefund[];
  total_shipping_price_set?: {
    shop_money?: {
      amount: string;
      currency_code: string;
    };
    presentment_money?: {
      amount: string;
      currency_code: string;
    };
  };
}

// ---------- WooCommerce ----------
interface WooProduct {
  id: number;
  name: string;
  price: string;
}
interface WooBillingAddress {
  first_name?: string;
  last_name?: string;
  company?: string;
  address_1?: string;
  address_2?: string;
  city?: string;
  state?: string;
  postcode?: string;
  country?: string;
  email?: string;
  phone?: string;
}
interface WooShippingAddress {
  first_name?: string;
  last_name?: string;
  company?: string;
  address_1?: string;
  address_2?: string;
  city?: string;
  state?: string;
  postcode?: string;
  country?: string;
  phone?: string;
}
interface WooCustomer {
  id: number;
  first_name: string;
  last_name: string;
  email: string;
  billing?: WooBillingAddress[];
  shipping?: WooShippingAddress[];
}
interface WooFeeLine {
  id: number;
  name: string;
  amount: string;
  total?: string;
  tax_class?: string;
  tax_status?: string;
}
interface WooLineItem {
  id: number;
  name: string;
  product_id: number;
  quantity: number;
  subtotal: string; // subtotal for this item
  total: string; // total after any line-item discount
  tax?: string;
  [key: string]: any; // for any other optional fields
}
interface WooRefund {
  id: number;
  total: string; // refunded amount
  refund_tax?: string; // refunded tax
}
interface WooOrder {
  id: number;
  number: string;
  subtotal: string;
  total_tax?: string;
  status: string;
  fee_lines: WooFeeLine[];
  shipping_total: string;
  line_items: WooLineItem[];
  discount_total: string;
  date_created: string;
  refunds?: WooRefund[];
}

// ---------- Magento ----------
interface MagentoProduct {
  id: number;
  name: string;
  sku: string;
  price: number;
}
interface MagentoCustomer {
  id: number;
  firstname: string;
  lastname: string;
  email: string;
}
interface MagentoRefund {
  id: number;
  subtotal: string;
  shipping_amount: string;
  tax_amount: string;
}

interface MagentoOrder {
  id: number;
  increment_id: string;
  subtotal: string; // subtotal of the order (without tax)
  grand_total: string; // total including tax and shipping
  discount_amount: string;
  tax_amount: string;
  shipping_amount: string;
  state: string; // order status (complete, processing, pending, etc.)
  created_at: string;
  refunds?: MagentoRefund[]; // optional refunds array
}

type Platform = "Shopify" | "Woocommerce" | "Magento" | null;

//  Main Component
export default function Dashboard() {
  const [platform, setPlatform] = useState<Platform>(null);
  const [storeCurrency, setStoreCurrency] = useState<string>("INR"); // Default to INR
  const [data, setData] = useState({
    shopify: {
      products: [] as ShopifyProduct[],
      customers: [] as ShopifyCustomer[],
      orders: [] as ShopifyOrder[],
    },
    woocommerce: {
      products: [] as WooProduct[],
      customers: [] as WooCustomer[],
      orders: [] as WooOrder[],
    },
    magento: {
      products: [] as MagentoProduct[],
      customers: [] as MagentoCustomer[],
      orders: [] as MagentoOrder[],
    },
  });
  const [metaSpend, setMetaSpend] = useState(0);

  const currencySymbol = getCurrencySymbol(storeCurrency);

  /* -------- WooCommerce calculation start -------- */

  const getOrderRevenue = (order: WooOrder) => {
    const grossSales = order.line_items.reduce(
      (sum, item) => sum + parseFloat(item.subtotal || "0"),
      0
    );
    const discounts = parseFloat(order.discount_total || "0");

    // Include shipping only for relevant statuses
    const shipping =
      order.status === "completed" ||
      order.status === "processing" ||
      order.status === "on-hold"
        ? parseFloat(order.shipping_total || "0")
        : 0;

    const tax = parseFloat(order.total_tax || "0");

    return grossSales - discounts + shipping + tax;
  };

  const customWoocommerceOrderRevenue = (order: WooOrder) => {
    // Calculate gross sales from all line items
    const grossSales = (order.line_items || []).reduce(
      (sum, item) => sum + parseFloat(item?.subtotal || "0"),
      0
    );

    const discounts = parseFloat(order?.discount_total || "0");
    const shippingRevenue = parseFloat(order?.shipping_total || "0"); // what customer paid
    const tax = parseFloat(order?.total_tax || "0");

    // Revenue from customer (Triple Whale "Order Revenue")
    const orderRevenue = grossSales - discounts + shippingRevenue + tax;

    return {
      orderRevenue,
    };
  };

  const getRefundsExcludingTax = (order: WooOrder) => {
    if (!order.refunds || order.refunds.length === 0) return 0;
    return order.refunds.reduce(
      (sum, refund) => sum + parseFloat(refund.total || "0"), // exclude refund.tax
      0
    );
  };

  const allOrders = data.woocommerce.orders;

  const totalOrderRevenue = allOrders.reduce(
    (sum, order) => sum + getOrderRevenue(order),
    0
  );

  const totalSales = allOrders.reduce(
    (sum, order) =>
      sum + (getOrderRevenue(order) - getRefundsExcludingTax(order)),
    0
  );

  const totalShipping = allOrders.reduce(
    (sum, order) => sum + parseFloat(order.shipping_total || "0"),
    0
  );

  const shippingCost = allOrders.reduce((sum, order) => {
    // Include shipping only for completed, processing, or on-hold orders
    if (
      order.status === "completed" ||
      order.status === "processing" ||
      order.status === "on-hold"
    ) {
      return sum + parseFloat(order.shipping_total || "0");
    }
    return sum; // ignore other statuses
  }, 0);

  // Total tax across all orders
  const totalTax = allOrders.reduce(
    (sum, order) => sum + parseFloat(order.total_tax || "0"),
    0
  );

  //  total number of orders
  const totalOrders = data.woocommerce.orders.length;

  const averageOrderValue =
    totalOrders > 0
      ? (totalOrderRevenue - shippingCost - totalTax) / totalOrders
      : 0;

  // True Average Order Value (AOV)

  const trueAOVOrders = allOrders
    .map((order) => {
      const orderRevenue = getOrderRevenue(order);
      const netRevenue =
        orderRevenue -
        parseFloat(order.shipping_total || "0") -
        parseFloat(order.total_tax || "0");
      return netRevenue; // only include positive orders
    })
    .filter((netRevenue) => netRevenue > 0); // remove zero or negative orders

  const totalNetRevenue = trueAOVOrders.reduce((sum, value) => sum + value, 0);
  const trueAOV =
    trueAOVOrders.length > 0 ? totalNetRevenue / trueAOVOrders.length : 0;

  const woocommerceHandlingFees = data.woocommerce.orders.reduce(
    (sum, order) => {
      if (Array.isArray(order.fee_lines) && order.fee_lines.length > 0) {
        const orderFeeTotal = order.fee_lines.reduce(
          (feeSum, fee) => feeSum + parseFloat(fee.amount || "0"),
          0
        );
        return sum + orderFeeTotal;
      }
      return sum;
    },
    0
  );

  /* -------- WooCommerce calculation end -------- */

  /*---------- Shopify calculaion Start -------- */

  //  Total number of orders
  const totalShopifyOrders = data.shopify.orders.length;

  // Shopify Order Revenue
  const getShopifyOrderRevenue = (order: ShopifyOrder) => {
    const grossSales = parseFloat(order.total_price || "0");

    const discounts = parseFloat(order.total_discounts || "0");

    const shipping =
      order.financial_status === "paid"
        ? parseFloat(order.total_shipping_price_set?.shop_money?.amount || "0")
        : 0;

    const tax = parseFloat(order.total_tax || "0");

    // Final revenue calculation (same logic as WooCommerce)
    return grossSales - discounts + shipping + tax;
  };

  const customShopifyOrderRevenue = (order: ShopifyOrder) => {
    const grossSales = parseFloat(order?.total_price || "0");

    const discounts = parseFloat(order?.total_discounts || "0");

    const shippingRevenue =
      order?.financial_status === "paid"
        ? parseFloat(order?.total_shipping_price_set?.shop_money?.amount || "0")
        : 0;

    const tax = parseFloat(order?.total_tax || "0");

    const orderRevenue = grossSales - discounts + shippingRevenue + tax;

    return {
      orderRevenue,
    };
  };

  const allShopifyOrders = data.shopify.orders;

  const totalShopifyOrderRevenue = allShopifyOrders.reduce(
    (sum, order) => sum + getShopifyOrderRevenue(order),
    0
  );

  // calculate total sales (including tax, minus discount)
  const getShopifyRefundsExcludingTax = (order: ShopifyOrder) => {
    if (!order.refunds || order.refunds.length === 0) return 0;

    return order.refunds.reduce((sum, refund) => {
      const refundTotal =
        refund.refund_line_items?.reduce(
          (refundSum, item) =>
            refundSum +
            parseFloat(item.line_item?.price || "0") *
              (item.line_item?.quantity || 1),
          0
        ) || 0; //

      return sum + refundTotal;
    }, 0);
  };

  const shopifyTotalSales = allShopifyOrders.reduce(
    (sum, order) =>
      sum +
      (getShopifyOrderRevenue(order) - getShopifyRefundsExcludingTax(order)),
    0
  );

  //  Average Order Value (AOV)
  const totalRevenue = allShopifyOrders.reduce(
    (sum, order) => sum + getShopifyOrderRevenue(order),
    0
  );

  const overallAOV =
    allShopifyOrders.length > 0 ? totalRevenue / allShopifyOrders.length : 0;

  //  True AOV (based on paid orders)
  const paidOrders = allShopifyOrders.filter(
    (order) => order.financial_status === "paid"
  );

  const totalRevenuePaid = paidOrders.reduce(
    (sum, order) => sum + getShopifyOrderRevenue(order),
    0
  );

  const shopifyTrueAOV =
    paidOrders.length > 0 ? totalRevenuePaid / paidOrders.length : 0;

  /* --------- Shopify calculaion End ----------  */

  /*---------- Magento calculaion Start -------- */
  // Total number of orders
  const totalMagentoOrders = data.magento.orders.length;

  // Function to calculate Magento order revenue (like WooCommerce)
  const getMagentoOrderRevenue = (order: MagentoOrder) => {
    const grossSales = parseFloat(order.subtotal || "0"); // subtotal without tax
    const discounts = parseFloat(order.discount_amount || "0"); // discounts
    const shipping =
      order.state === "complete" || order.state === "processing"
        ? parseFloat(order.shipping_amount || "0")
        : 0;
    const tax = parseFloat(order.tax_amount || "0"); // tax

    // Revenue = subtotal - discount + shipping + tax
    return grossSales - discounts + shipping + tax;
  };

  // Total revenue (all orders)
  const totalMagentoRevenue = data.magento.orders.reduce(
    (sum, order) => sum + getMagentoOrderRevenue(order),
    0
  );

  // Refunds (exclude tax)
  const getMagentoRefundsExcludingTax = (order: MagentoOrder) => {
    if (!order.refunds || order.refunds.length === 0) return 0;

    return order.refunds.reduce((sum, refund) => {
      const refundTotal =
        parseFloat(refund.subtotal || "0") +
        parseFloat(refund.shipping_amount || "0") -
        parseFloat(refund.tax_amount || "0");
      return sum + refundTotal;
    }, 0);
  };

  // Total sales (after refunds)
  const totalMagentoSales = data.magento.orders.reduce(
    (sum, order) =>
      sum +
      (getMagentoOrderRevenue(order) - getMagentoRefundsExcludingTax(order)),
    0
  );

  // Shipping cost for completed/processing orders
  const magentoShippingCost = data.magento.orders.reduce((sum, order) => {
    if (order.state === "complete" || order.state === "processing") {
      return sum + parseFloat(order.shipping_amount || "0");
    }
    return sum;
  }, 0);

  // Overall Average Order Value (AOV) - all orders
  const magentoOverallAOV =
    totalMagentoOrders > 0
      ? (totalMagentoRevenue -
          magentoShippingCost -
          data.magento.orders.reduce(
            (sum, o) => sum + parseFloat(o.tax_amount || "0"),
            0
          )) /
        totalMagentoOrders
      : 0;

  // True AOV (only completed/processing orders)
  const completedOrders = data.magento.orders.filter(
    (order) => order.state === "complete" || order.state === "processing"
  );

  const magentoTotalNetRevenue = completedOrders.reduce((sum, order) => {
    const netRevenue =
      getMagentoOrderRevenue(order) -
      parseFloat(order.shipping_amount || "0") -
      parseFloat(order.tax_amount || "0");
    return netRevenue > 0 ? sum + netRevenue : sum;
  }, 0);

  const magentoTrueAOV =
    completedOrders.length > 0
      ? magentoTotalNetRevenue / completedOrders.length
      : 0;

  /* --------- Magento calculaion End ----------  */

  const fetchData = async <T,>(
    url: string,
    token: string | null
  ): Promise<T[]> => {
    try {
      const res = await fetch(url, {
        headers: {
          ...(token ? { Authorization: `Bearer ${token}` } : {}),
          "Content-Type": "application/json",
        },
      });
      if (!res.ok) return [];
      const body = await res.json();
      return Array.isArray(body)
        ? body
        : body.items || body.products || body.customers || body.orders || [];
    } catch (err) {
      console.error(err);
      return [];
    }
  };

  // ⚙️ Fetch store and data
  useEffect(() => {
    (async () => {
      const token =
        typeof window !== "undefined"
          ? localStorage.getItem("User_token")
          : null;

      const storeRes = await fetch("http://localhost:5000/api/user/store", {
        headers: token ? { Authorization: `Bearer ${token}` } : {},
      });
      if (!storeRes.ok) return;

      const storeData = await storeRes.json();
      setPlatform(storeData.platform);
      setStoreCurrency(storeData.store_currency || "INR");

      // Fetch Meta insights spend for dashboard
      try {
        const insightsRes = await fetch(
          "http://localhost:5000/api/meta/insights?level=campaign&time_increment=1",
          { headers: token ? { Authorization: `Bearer ${token}` } : {} }
        );
        if (insightsRes.ok) {
          const body = await insightsRes.json();
          const insights: any[] = Array.isArray(body?.insights)
            ? body.insights
            : [];
          const totalSpend = insights.reduce(
            (sum, row: any) => sum + parseFloat(row?.spend || "0"),
            0
          );
          const totalSpendInRupees = totalSpend * 9.29;
          setMetaSpend(totalSpendInRupees);
          console.log("Meta ads", totalSpendInRupees);
        }
      } catch (_) {
        // ignore dashboard meta fetch errors
      }

      if (storeData.platform === "Shopify") {
        const [products, customers, orders] = await Promise.all([
          fetchData<ShopifyProduct>(
            "http://localhost:5000/api/shopify/products",
            token
          ),
          fetchData<ShopifyCustomer>(
            "http://localhost:5000/api/shopify/customers",
            token
          ),
          fetchData<ShopifyOrder>(
            "http://localhost:5000/api/shopify/orders",
            token
          ),
        ]);
        console.log("Shopify Products:", products);
        console.log("Shopify Customers:", customers);
        console.log("Shopify Orders:", orders);
        setData((prev) => ({
          ...prev,
          shopify: { products, customers, orders },
        }));
      } else if (storeData.platform === "Woocommerce") {
        const [products, customers, orders] = await Promise.all([
          fetchData<WooProduct>(
            "http://localhost:5000/api/woocommerce/products",
            token
          ),
          fetchData<WooCustomer>(
            "http://localhost:5000/api/woocommerce/customers",
            token
          ),
          fetchData<WooOrder>(
            "http://localhost:5000/api/woocommerce/orders",
            token
          ),
        ]);
        console.log("WooCommerce Products:", products);
        console.log("WooCommerce Customers:", customers);
        console.log("WooCommerce Orders:", orders);
        setData((prev) => ({
          ...prev,
          woocommerce: { products, customers, orders },
        }));
      } else if (storeData.platform === "Magento") {
        // Fetch Magento data sequentially (orders → products → customers)
        try {
          const orders = await fetchData<MagentoOrder>(
            "http://localhost:5000/api/magento/orders",
            token
          );
          console.log("Magento Orders:", orders);

          const products = await fetchData<MagentoProduct>(
            "http://localhost:5000/api/magento/products",
            token
          );
          console.log("Magento Products:", products);

          const customers = await fetchData<MagentoCustomer>(
            "http://localhost:5000/api/magento/customers",
            token
          );
          console.log("Magento Customers:", customers);

          setData((prev) => ({
            ...prev,
            magento: { products, customers, orders },
          }));
        } catch (error) {
          console.error("Error fetching Magento data:", error);
        }
      }
    })();
  }, []);

  /*------------- custom matrix calculation --------------*/
  const customAdsSpend = Math.round(metaSpend);
  const customOrderRevenue = Math.round(
    data.woocommerce.orders.reduce(
      (sum, order) => sum + getOrderRevenue(order),
      0
    ) +
      data.shopify.orders.reduce(
        (sum, order) => sum + getShopifyOrderRevenue(order),
        0
      ) +
      data.magento.orders.reduce(
        (sum, order) => sum + getMagentoOrderRevenue(order),
        0
      )
  );
  const customNetProfit = Math.round(customOrderRevenue - customAdsSpend);
  // Only calculate MER and Net Margin if order revenue is greater than 0 to avoid division by zero
  const customMER =
    customOrderRevenue > 0
      ? Math.round((customAdsSpend / customOrderRevenue) * 100)
      : 0;
  const customNetMargin =
    customOrderRevenue > 0
      ? Math.round((customNetProfit / customOrderRevenue) * 100)
      : 0;

  return (
    <div className="container p-4 max-w-7xl mx-auto">
      <div className=" mx-auto">
        <CustomMatrix
          customAdsSpend={customAdsSpend}
          customNetProfit={customNetProfit}
          customMER={customMER}
          customNetMargin={customNetMargin}
        />
        <KlaviyoSection />
      </div>
      {/* -------- Shopify -------- */}
      {platform === "Shopify" && (
        <>
          <div className=" mx-auto">
            <div className=" mx-auto mt-8">
              <div className="flex justify-start items-center gap-2">
                <Image
                  src={shopifyImage}
                  alt="shopify image"
                  height={20}
                  width={20}
                />{" "}
                <h2 className="font-semibold font-custom text-xl  ">Store</h2>
              </div>
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 py-5 ">
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500 flex items-center justify-start gap-2">
                    <Image
                      src={shopifyImage}
                      alt="shopify image"
                      height={16}
                      width={16}
                    />{" "}
                    Order Revenue
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-sm py-2">
                    {" "}
                    <span className="text-2xl font-semibold mr-2">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">
                      {Math.round(totalShopifyOrderRevenue)}
                    </p>{" "}
                  </div>
                </div>
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500 flex items-center justify-start gap-2">
                    <Image
                      src={shopifyImage}
                      alt="shopify image"
                      height={16}
                      width={16}
                    />{" "}
                    True AOV
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    <span className="text-2xl font-semibold mr-2">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">
                      {Math.round(shopifyTrueAOV)}
                    </p>
                  </div>
                </div>
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500 flex items-center justify-start gap-2">
                    <Image
                      src={shopifyImage}
                      alt="shopify image"
                      height={16}
                      width={16}
                    />{" "}
                    Avarage Order Value
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    <span className="text-2xl font-semibold mr-2">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">
                      {Math.round(overallAOV)}
                    </p>
                  </div>
                </div>
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500 flex items-center justify-start gap-2">
                    <Image
                      src={shopifyImage}
                      alt="shopify image"
                      height={16}
                      width={16}
                    />{" "}
                    Total Sales
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    <span className="text-2xl font-semibold mr-2">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">
                      {Math.round(shopifyTotalSales)}
                    </p>
                  </div>
                </div>
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500 flex items-center justify-start gap-2">
                    <Image
                      src={shopifyImage}
                      alt="shopify image"
                      height={16}
                      width={16}
                    />{" "}
                    Orders
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl font-semibold py-2">
                    {totalShopifyOrders}
                  </div>
                </div>
              </div>
            </div>

            {/* Meta ads */}

            <div className="mt-10">
              <div className="flex justify-start items-center gap-2">
                <Image
                  src={metaAdsImage}
                  alt="Meta image"
                  height={20}
                  width={20}
                />
                <h2 className="font-semibold font-custom text-xl  ">
                  Meta Ads
                </h2>
              </div>
              <div className=" grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4  gap-3 py-5 ">
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <div className="flex gap-2 items-center">
                    <Image
                      src={metaAdsImage}
                      alt="Meta image"
                      height={20}
                      width={20}
                    />
                    <h3 className="font-custom text-md font-semibold text-gray-500 flex gap-2  ">
                      Meta Ads
                    </h3>
                  </div>

                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold">
                      <IndianRupee />
                    </span>{" "}
                    <p className="text-2xl font-semibold">
                      {Math.round(metaSpend)}
                    </p>{" "}
                  </div>
                </div>

                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <div className="flex gap-2 items-center">
                    <Image
                      src={metaAdsImage}
                      alt="Meta  image"
                      height={20}
                      width={20}
                    />
                    <h3 className="font-custom text-md font-semibold text-gray-500 flex gap-2  ">
                      ROAS
                    </h3>
                  </div>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold">
                      <IndianRupee />
                    </span>{" "}
                    <p className="text-2xl font-semibold">0</p>{" "}
                  </div>
                </div>
              </div>
            </div>

            {/* Web Analysis Start */}
            <WebAnalysisSection />
            {/* Web Analysis Ends */}

            {/* Google Ads Start */}
            <GoogleAdsSection />
            {/* Google Ads End */}

            <div className="mt-4  mx-auto">
              <h2 className="font-semibold font-custom text-xl flex gap-2 items-center pt-4 ">
                <BanknoteArrowDown size={22} /> Expenses
              </h2>
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 py-5 ">
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500">
                    Payment Gateways
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semiboldm mr-2">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">0</p>{" "}
                  </div>
                </div>
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500 flex items-center justify-start gap-2">
                    <Image
                      src={shopifyImage}
                      alt="woocommerce image"
                      height={16}
                      width={16}
                    />{" "}
                    COGS
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold mr-2">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">0</p>{" "}
                  </div>
                </div>
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500 flex items-center justify-start gap-2">
                    <Image
                      src={shopifyImage}
                      alt="woocommerce image"
                      height={16}
                      width={16}
                    />{" "}
                    Handling Fess
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold mr-2">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">0</p>{" "}
                  </div>
                </div>
                <div className="border rounded-md px-4 pt-2 pb-10 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500 flex items-center justify-start gap-2">
                    <Image
                      src={shopifyImage}
                      alt="woocommerce image"
                      height={16}
                      width={16}
                    />{" "}
                    Shipping
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold mr-2">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">0</p>{" "}
                  </div>
                </div>
                <div className="border rounded-md px-4 pt-2 pb-10 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500">
                    Custom Expenses
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold mr-2">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">0</p>{" "}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </>
      )}

      {/* -------- WooCommerce -------- */}
      {platform === "Woocommerce" && (
        <>
          <div className=" mx-auto ">
            {/* Woocommerce Store Data */}
            <div className="mx-auto mt-10">
              <div className="flex justify-start items-center gap-2">
                <Image
                  src={woocommerceImage}
                  alt="woocommerce image"
                  height={24}
                  width={24}
                />{" "}
                <h2 className="font-semibold font-custom text-xl  ">Store</h2>
              </div>
              <div className="  grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4  gap-4 py-5 ">
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500 flex gap-2">
                    <Image
                      src={woocommerceImage}
                      alt="woocommerce image"
                      height={20}
                      width={20}
                    />{" "}
                    Order Revenue
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold mr-2">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">
                      {Math.round(totalOrderRevenue)}
                    </p>{" "}
                  </div>
                </div>
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500 flex gap-2">
                    <Image
                      src={woocommerceImage}
                      alt="woocommerce image"
                      height={20}
                      width={20}
                    />{" "}
                    True AOV
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold  mr-2">
                      {currencySymbol}
                    </span>
                    {"  "}
                    <p className="text-2xl font-semibold">
                      {Math.round(trueAOV)}
                    </p>{" "}
                  </div>
                </div>
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500 flex gap-2">
                    <div style={{ height: "auto", width: "auto" }}>
                      <Image
                        src={woocommerceImage}
                        alt="woocommerce image"
                        height={20}
                        width={20}
                      />
                    </div>
                    Avarage Order Value
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold mr-2">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">
                      {Math.round(averageOrderValue)}
                    </p>{" "}
                  </div>
                </div>
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500 flex gap-2">
                    <div style={{ height: "auto", width: "auto" }}>
                      <Image
                        src={woocommerceImage}
                        alt="woocommerce image"
                        height={20}
                        width={20}
                      />
                    </div>
                    Total Sales
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold mr-2">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">
                      {Math.round(totalSales)}
                    </p>{" "}
                  </div>
                </div>
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500 flex gap-2">
                    <div style={{ height: "auto", width: "auto" }}>
                      <Image
                        src={woocommerceImage}
                        alt="woocommerce image"
                        height={20}
                        width={20}
                      />
                    </div>
                    Orders
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    <p className="text-2xl font-semibold">
                      {data.woocommerce.orders.length}
                    </p>{" "}
                  </div>
                </div>
              </div>
            </div>

            {/* Meta ads */}

            <div className="mt-10">
              <div className="flex justify-start items-center gap-2">
                <Image
                  src={metaAdsImage}
                  alt="Google Ads image"
                  height={20}
                  width={20}
                />
                <h2 className="font-semibold font-custom text-xl  ">
                  Meta Ads
                </h2>
              </div>
              <div className="  grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4  gap-4 py-5 ">
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <div className="flex gap-2 items-center">
                    <Image
                      src={metaAdsImage}
                      alt="Meta Ads image"
                      height={20}
                      width={20}
                    />
                    <h3 className="font-custom text-md font-semibold text-gray-500 flex gap-2  ">
                      Facebook Ads
                    </h3>
                  </div>

                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold">
                      <IndianRupee />
                    </span>{" "}
                    <p className="text-2xl font-semibold">
                      {Math.round(metaSpend)}
                    </p>{" "}
                  </div>
                </div>

                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <div className="flex gap-2 items-center">
                    <Image
                      src={metaAdsImage}
                      alt="Meta Ads image"
                      height={20}
                      width={20}
                    />
                    <h3 className="font-custom text-md font-semibold text-gray-500 flex gap-2  ">
                      ROAS
                    </h3>
                  </div>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold">
                      <IndianRupee />
                    </span>{" "}
                    <p className="text-2xl font-semibold">0</p>{" "}
                  </div>
                </div>
              </div>
            </div>

            {/* Web Analysis Start */}
            <WebAnalysisSection />
            {/* Web Analysis Ends */}

            {/* Google Ads Start */}
            <GoogleAdsSection />
            {/* Google Ads End */}

            <div className="mt-6 mx-auto">
              <h2 className="font-semibold font-custom text-xl flex items-center gap-2 pt-4 ">
                <BanknoteArrowDown size={22} /> Expenses
              </h2>
              <div className="  grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4  gap-4 py-5 ">
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500">
                    Payment Gateways
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold mr-2">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">0</p>{" "}
                  </div>
                </div>
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500 flex gap-2">
                    <Image
                      src={woocommerceImage}
                      alt="woocommerce image"
                      height={20}
                      width={20}
                    />{" "}
                    COGS
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold mr-2">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">0</p>{" "}
                  </div>
                </div>
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500 flex gap-2">
                    <Image
                      src={woocommerceImage}
                      alt="woocommerce image"
                      height={20}
                      width={20}
                    />{" "}
                    Handling Fees
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold mr-2">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">
                      {woocommerceHandlingFees}
                    </p>{" "}
                  </div>
                </div>
                <div className="border rounded-md px-4 pt-2 pb-10 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500 flex gap-2">
                    <Image
                      src={woocommerceImage}
                      alt="woocommerce image"
                      height={20}
                      width={20}
                    />{" "}
                    Shipping
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold mr-2">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">{shippingCost}</p>{" "}
                  </div>
                </div>
                <div className="border rounded-md px-4 pt-2 pb-10 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500">
                    Custom Expenses
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold mr-2">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">0</p>{" "}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </>
      )}

      {/* -------- Magento -------- */}
      {platform === "Magento" && (
        <>
          <div className=" mx-auto">
            <div className="mt-8 mx-auto">
              <div className="flex justify-start items-center gap-2">
                <Image
                  src={magentoImage}
                  alt="magento image"
                  height={20}
                  width={20}
                />{" "}
                <h2 className="font-semibold font-custom text-xl  ">Store</h2>
              </div>
              <div className="  grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 py-5 ">
                <div className=" border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500 flex gap-2">
                    <Image
                      src={magentoImage}
                      alt="magento image"
                      height={14}
                      width={18}
                    />{" "}
                    Order Revenue
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold mr-2">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">
                      {Math.round(totalMagentoRevenue)}
                    </p>{" "}
                  </div>
                </div>
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500 flex gap-2">
                    <Image
                      src={magentoImage}
                      alt="magento image"
                      height={14}
                      width={18}
                    />{" "}
                    True AOV
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold mr-2 ">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">
                      {Math.round(magentoTrueAOV)}
                    </p>{" "}
                  </div>
                </div>
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500 flex gap-2">
                    <Image
                      src={magentoImage}
                      alt="magento image"
                      height={14}
                      width={18}
                    />{" "}
                    Avarage Order Value
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold mr-2 ">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">
                      {Math.round(magentoOverallAOV)}
                    </p>{" "}
                  </div>
                </div>
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500 flex gap-2">
                    <Image
                      src={magentoImage}
                      alt="magento image"
                      height={14}
                      width={18}
                    />{" "}
                    Total Sales
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold mr-2 ">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">
                      {Math.round(totalMagentoSales)}
                    </p>{" "}
                  </div>
                </div>
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500 flex gap-2">
                    <Image
                      src={magentoImage}
                      alt="magento image"
                      height={14}
                      width={18}
                    />{" "}
                    Orders
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    <p className="text-2xl font-semibold">
                      {totalMagentoOrders}
                    </p>
                  </div>
                </div>
              </div>
            </div>

            {/* Meta ads */}

            <div className="mt-10">
              <div className="flex justify-start items-center gap-2">
                <Image
                  src={metaAdsImage}
                  alt="Google Ads image"
                  height={20}
                  width={20}
                />
                <h2 className="font-semibold font-custom text-xl  ">
                  Meta Ads
                </h2>
              </div>
              <div className="  grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 py-5 ">
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <div className="flex gap-2 items-center">
                    <Image
                      src={metaAdsImage}
                      alt="Meta Ads image"
                      height={20}
                      width={20}
                    />
                    <h3 className="font-custom text-md font-semibold text-gray-500 flex gap-2  ">
                      Facebook Ads
                    </h3>
                  </div>

                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold">
                      <IndianRupee />
                    </span>{" "}
                    <p className="text-2xl font-semibold">
                      {Math.round(metaSpend)}
                    </p>{" "}
                  </div>
                </div>

                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <div className="flex gap-2 items-center">
                    <Image
                      src={metaAdsImage}
                      alt="Meta Ads image"
                      height={20}
                      width={20}
                    />
                    <h3 className="font-custom text-md font-semibold text-gray-500 flex gap-2  ">
                      ROAS
                    </h3>
                  </div>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold">
                      <IndianRupee />
                    </span>{" "}
                    <p className="text-2xl font-semibold">0</p>{" "}
                  </div>
                </div>
              </div>
            </div>

            {/* Web Analysis Start */}
            <WebAnalysisSection />
            {/* Web Analysis Ends */}

            {/* Google Ads Start */}
            <GoogleAdsSection />
            {/* Google Ads End */}

            <div className="mt-6 mx-auto">
              <h2 className="font-semibold font-custom text-xl flex gap-2 items-center pt-4 ">
                <BanknoteArrowDown size={22} /> Expenses
              </h2>
              <div className="  grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 py-5 ">
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500">
                    Payment Gateways
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold mr-2 ">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">0</p>{" "}
                  </div>
                </div>
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500 flex gap-2">
                    <Image
                      src={magentoImage}
                      alt="magento image"
                      height={14}
                      width={18}
                    />{" "}
                    COGS
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold mr-2 ">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">0</p>{" "}
                  </div>
                </div>
                <div className="border rounded-md px-4 pb-10 pt-2 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500 flex gap-2">
                    <Image
                      src={magentoImage}
                      alt="magento image"
                      height={14}
                      width={18}
                    />{" "}
                    Handling Fees
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold mr-2">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">0</p>{" "}
                  </div>
                </div>
                <div className="border rounded-md px-4 pt-2 pb-10 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500 flex gap-2">
                    <Image
                      src={magentoImage}
                      alt="magento image"
                      height={14}
                      width={18}
                    />{" "}
                    Shipping
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold mr-2">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">
                      {Math.round(magentoShippingCost)}
                    </p>{" "}
                  </div>
                </div>
                <div className="border rounded-md px-4 pt-2 pb-10 shadow-md">
                  <h3 className="font-custom text-md font-semibold text-gray-500">
                    Custom Expenses
                  </h3>
                  <div className="flex justify-start items-center gap-0 text-2xl py-2">
                    {" "}
                    <span className="text-2xl font-semibold mr-2">
                      {currencySymbol}
                    </span>{" "}
                    <p className="text-2xl font-semibold">0</p>{" "}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </>
      )}
    </div>
  );
}
